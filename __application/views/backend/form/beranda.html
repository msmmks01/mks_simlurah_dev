<style>
/* === Dashboard Modern === */
:root{
  --bg: #f6f8fb;
  --card: #ffffff;
  --text: #1f2937;
  --muted: #6b7280;
  --border: #e5e7eb;

  --blue: #2563eb;
  --red: #ef4444;
  --green: #16a34a;
  --yellow: #f59e0b;

  --shadow: 0 10px 24px rgba(17, 24, 39, 0.08);
  --shadow-hover: 0 14px 30px rgba(17, 24, 39, 0.12);
  --radius: 16px;
}

.dashboard{
  /* background: var(--bg); */
  /* padding: 12px 0; */
  color: var(--text);
}

/* Header */
.dash-header{
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  gap: 16px;
  margin-bottom: 14px;
  flex-wrap: wrap;
}

.dash-title h2{
  margin: 0;
  font-weight: 700;
  letter-spacing: -0.02em;
}
.dash-subtitle{
  margin: 4px 0 0 0;
  color: var(--muted);
}

/* Filters */
.dash-filters{
  display: flex;
  gap: 12px;
  align-items: flex-end;
  flex-wrap: wrap;
}

.filter-item label{
  display: block;
  font-size: 12px;
  color: var(--muted);
  margin-bottom: 6px;
}

.filter-item .form-control{
  border-radius: 12px;
  border: 1px solid var(--border);
  height: 38px;
  box-shadow: none;
}

.filter-actions .btn{
  border-radius: 12px;
  height: 38px;
  padding: 0 14px;
}

/* KPI */
.dash-kpi{
  margin-bottom: 10px;
}

.kpi-card{
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 14px 14px;
  display: flex;
  gap: 12px;
  align-items: center;
  min-height: 92px;
  transition: .2s ease;
  margin-bottom: 14px;
}

.kpi-card:hover{
  transform: translateY(-2px);
  box-shadow: var(--shadow-hover);
}

.kpi-icon{
  width: 48px;
  height: 48px;
  border-radius: 14px;
  display: grid;
  place-items: center;
  color: #fff;
  font-size: 20px;
}

.kpi-body{
  flex: 1;
  min-width: 0;
}

.kpi-label{
  font-size: 12px;
  color: var(--muted);
  margin-bottom: 4px;
}

.kpi-value{
  font-size: 22px;
  font-weight: 800;
  line-height: 1.15;
  letter-spacing: -0.02em;
  margin-bottom: 4px;
}

.kpi-unit{
  font-size: 12px;
  font-weight: 600;
  color: var(--muted);
  margin-left: 6px;
}

.kpi-hint{
  font-size: 12px;
  color: var(--muted);
}

/* KPI color variants */
.kpi-blue .kpi-icon{ background: linear-gradient(135deg, #60a5fa, var(--blue)); }
.kpi-red .kpi-icon{ background: linear-gradient(135deg, #fb7185, var(--red)); }
.kpi-green .kpi-icon{ background: linear-gradient(135deg, #4ade80, var(--green)); }
.kpi-yellow .kpi-icon{ background: linear-gradient(135deg, #fcd34d, var(--yellow)); }

/* Cards */
.dash-card{
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 14px;
  margin-bottom: 14px;
}

.dash-card-header{
  display: flex;
  align-items: baseline;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 12px;
}

.dash-card-header h3{
  margin: 0;
  font-size: 16px;
  font-weight: 800;
  letter-spacing: -0.01em;
}

.dash-card-actions .btn{
  border-radius: 12px;
}

/* Tabs */
.dash-tabs{
  border-bottom: 1px solid var(--border);
  margin-bottom: 12px;
}

.dash-tabs > li > a{
  border: none !important;
  color: var(--muted);
  font-weight: 700;
}

.dash-tabs > li.active > a{
  color: var(--text) !important;
  background: transparent !important;
  border-bottom: 2px solid var(--blue) !important;
}

.dash-tab-content{
  padding-top: 6px;
}

.chart-box{
  width: 100%;
  min-height: 320px;
}

/* List */
.dash-list{
  margin-top: 10px;
  border-top: 1px dashed var(--border);
  padding-top: 10px;
}

.dash-list-item{
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 12px;
  padding: 10px 0;
  border-bottom: 1px dashed var(--border);
}

.dash-list-title{
  font-weight: 700;
  font-size: 13px;
}

.dash-list-value{
  font-weight: 800;
  font-size: 13px;
  color: var(--text);
}

/* Mini stat (range usia) */
.mini-stat{
  display: block;
  background: #f9fafb;
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 12px;
  text-decoration: none !important;
  color: var(--text) !important;
  transition: .2s ease;
  margin-bottom: 12px;
}

.mini-stat:hover{
  transform: translateY(-2px);
  box-shadow: var(--shadow-hover);
  background: #ffffff;
}

.mini-stat-title{
  font-weight: 800;
  font-size: 13px;
  margin-bottom: 6px;
}

.mini-stat-value{
  color: var(--muted);
  font-weight: 700;
}

/* Gender card */
.gender-card{
  display: flex;
  gap: 12px;
  align-items: center;
  padding: 12px;
  border: 1px solid var(--border);
  border-radius: 14px;
  background: #f9fafb;
  text-decoration: none !important;
  color: var(--text) !important;
  margin-bottom: 10px;
  transition: .2s ease;
}

.gender-card:hover{
  background: #fff;
  transform: translateY(-2px);
  box-shadow: var(--shadow-hover);
}

.gender-icon{
  width: 42px;
  height: 42px;
  border-radius: 14px;
  display: grid;
  place-items: center;
  background: rgba(37, 99, 235, 0.12);
  color: var(--blue);
  font-size: 20px;
}

.gender-title{
  font-weight: 900;
  font-size: 12px;
  color: var(--muted);
}

.gender-value{
  font-weight: 900;
  font-size: 16px;
}

/* Survey card */
.survey-card{
  display: block;
  text-align: center;
  background: linear-gradient(135deg, #06b6d4, #2563eb);
  color: #fff !important;
  border: none;
  padding: 18px;
  border-radius: 18px;
  text-decoration: none !important;
  transition: .25s ease;
}

.survey-card:hover{
  transform: translateY(-2px) scale(1.01);
  box-shadow: var(--shadow-hover);
  filter: brightness(1.02);
}

.survey-title{
  font-size: 16px;
  font-weight: 900;
  letter-spacing: -0.01em;
}

.survey-subtitle{
  font-size: 12px;
  opacity: .92;
  margin: 6px 0 12px;
}

.survey-qr{
  width: 170px;
  height: 170px;
  border-radius: 14px;
  border: 4px solid rgba(255,255,255,0.55);
  background: #fff;
}

/* Table */
.dash-table{
  border-radius: 12px;
  overflow: hidden;
}

.dash-table thead th{
  background: #f3f4f6;
  color: #111827;
  font-weight: 900;
  border: 1px solid var(--border) !important;
  white-space: nowrap;
}

.dash-table td{
  border: 1px solid var(--border) !important;
  vertical-align: middle !important;
}

.dash-table-total td{
  background: #f9fafb;
}

/* Responsive tweaks */
@media (max-width: 768px){
  .chart-box{ min-height: 260px; }
  .survey-qr{ width: 180px; height: 180px; }
}

</style>
<section class="content ">
	<div class="row">
		<div class="col-lg-12">
			{if $auth.cl_user_group_id eq 4 && $auth.cl_user_group_id eq 5}
				{if $auth.nip_pegawai eq null}
					<div class="row">
						<div class="col-lg-12">
							<div class="bg-danger text-white p-3">
								Anda belum mendaftarkan Nomor Identitas Pegawai Negeri Sipil. Anda tidak akan bisa menggunakan tanda tangan elektronik
							</div>
						</div>
					</div>
				{/if}
			{/if}
			<div class="dashboard">

  <!-- Header + Filter -->
  <div class="dash-header">
    <div class="dash-title">
      <h2>Dashboard Kelurahan</h2>
      <p class="dash-subtitle">Ringkasan data kependudukan & persuratan</p>
    </div>

    <div class="dash-filters">
      <div class="filter-item">
        <label>Tahun</label>
        <select id="filterTahun" class="form-control">
          <option value="{date('Y')}">{date('Y')}</option>
          <option value="{date('Y')-1}">{date('Y')-1}</option>
          <option value="{date('Y')-2}">{date('Y')-2}</option>
        </select>
      </div>
      <div class="filter-item">
        <label>Bulan</label>
        <select id="filterBulan" class="form-control">
          <option value="">Semua</option>
          <option value="1">Januari</option>
          <option value="2">Februari</option>
          <option value="3">Maret</option>
          <option value="4">April</option>
          <option value="5">Mei</option>
          <option value="6">Juni</option>
          <option value="7">Juli</option>
          <option value="8">Agustus</option>
          <option value="9">September</option>
          <option value="10">Oktober</option>
          <option value="11">November</option>
          <option value="12">Desember</option>
        </select>
      </div>
      <div class="filter-item filter-actions">
        <button class="btn btn-primary btn-purple" type="button" onclick="applyDashboardFilter()">
          Terapkan
        </button>
      </div>
    </div>
  </div>

  <!-- KPI Cards -->
  <div class="row dash-kpi">
    <div class="col-md-3 col-sm-6 col-xs-12">
      <div class="kpi-card kpi-blue">
        <div class="kpi-icon"><i class="fa fa-users"></i></div>
        <div class="kpi-body">
          <div class="kpi-label">Penduduk Aktif</div>
          <div class="kpi-value">
            {$data.jumlah_penduduk|number_format:0:",":"."|default:'-'}
            <span class="kpi-unit">Orang</span>
          </div>
          <div class="kpi-hint">Total penduduk aktif terdata</div>
        </div>
      </div>
    </div>

    <div class="col-md-3 col-sm-6 col-xs-12">
      <div class="kpi-card kpi-red">
        <div class="kpi-icon"><i class="fa fa-id-card"></i></div>
        <div class="kpi-body">
          <div class="kpi-label">Kartu Keluarga</div>
          <div class="kpi-value">
            {$data.jumlah_kk|number_format:0:",":"."|default:'-'}
            <span class="kpi-unit">KK</span>
          </div>
          <div class="kpi-hint">Jumlah KK yang aktif</div>
        </div>
      </div>
    </div>

    <div class="col-md-3 col-sm-6 col-xs-12">
      <div class="kpi-card kpi-green">
        <div class="kpi-icon"><i class="fa fa-paper-plane"></i></div>
        <div class="kpi-body">
          <div class="kpi-label">Surat Keluar</div>
          <div class="kpi-value">
            {$data.jumlah_surat|number_format:0:",":"."|default:'-'}
            <span class="kpi-unit">Surat</span>
          </div>
          <div class="kpi-hint">Total surat keluar</div>
        </div>
      </div>
    </div>

    <div class="col-md-3 col-sm-6 col-xs-12">
      <div class="kpi-card kpi-yellow">
        <div class="kpi-icon"><i class="fa fa-inbox"></i></div>
        <div class="kpi-body">
          <div class="kpi-label">Surat Masuk</div>
          <div class="kpi-value">
            {$data.jumlah_surat_masuk|number_format:0:",":"."|default:'-'}
            <span class="kpi-unit">Surat</span>
          </div>
          <div class="kpi-hint">Total surat masuk</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="row">

    <!-- Charts -->
    <div class="col-md-8">
      <div class="dash-card">
        <div class="dash-card-header">
          <h3>Statistik Kependudukan</h3>
          <div class="dash-card-actions">
            <button class="btn btn-default btn-sm" type="button" onclick="refreshCharts()">Refresh</button>
          </div>
        </div>

        <!-- Tabs -->
        <ul class="nav nav-tabs dash-tabs" role="tablist">
		<li class="active"><a href="#tabPendidikan" role="tab" data-toggle="tab">Pendidikan</a></li>
          <li><a href="#tabAgama" role="tab" data-toggle="tab">Agama</a></li>
          <li><a href="#tabStatusKawin" role="tab" data-toggle="tab">Status Kawin</a></li>
          <li><a href="#tabStatusData" role="tab" data-toggle="tab">Status Penduduk</a></li>
          <li><a href="#tabRangeUmur" role="tab" data-toggle="tab">Range Umur</a></li>
          <li><a href="#tabSkm" role="tab" data-toggle="tab">SKM</a></li>
        </ul>

        <div class="tab-content dash-tab-content">
			<div class="tab-pane active" id="tabPendidikan">
			<div id="chart_pendidikan_new" style="min-height:360px;"></div>
			</div>
          <div class="tab-pane" id="tabAgama">
            <div id="chart_agama_new" class="chart-box"></div>
          </div>
         <div class="tab-pane" id="tabStatusKawin">
			<div id="chart_status_kawin_new" style="min-height:360px;"></div>
			</div>

			<div class="tab-pane" id="tabStatusData">
			<div id="chart_status_data_new" style="min-height:360px;"></div>
			</div>

			<div class="tab-pane" id="tabRangeUmur">
			<div id="chart_range_umur_new" style="min-height:360px;"></div>
			</div>
			
			<div class="tab-pane" id="tabSkm">
			<div id="chart_skm" style="min-height:360px;"></div>
			</div>

        </div>
      </div>

 

    </div>

    <!-- Side Panel -->
    <div class="col-md-4">

      <div class="dash-card">
        <div class="dash-card-header">
          <h3>Jenis Kelamin</h3>
          <small>Klik untuk cetak</small>
        </div>

        {foreach from=$data.jenis_kelamin item=rows}
          <a href="javascript:void(0)" class="gender-card" onclick="cetak_kelamin('{$rows.keterangan}')">
            <div class="gender-icon">
              {if $rows.keterangan eq 'PEREMPUAN'}
                <i class="fa fa-female"></i>
              {else}
                <i class="fa fa-male"></i>
              {/if}
            </div>
            <div class="gender-body">
              <div class="gender-title">{$rows.keterangan|upper|default:''}</div>
              <div class="gender-value">{$rows.total|number_format:0:",":"."|default:''} <small>Orang</small></div>
            </div>
          </a>
        {/foreach}
      </div>

      <a href="{$host}survei-kepuasan/{$auth.cl_user_group_id}/{$auth.cl_kecamatan_id}/{$auth.cl_kelurahan_desa_id}"
         class="dash-card survey-card"
         target="_blank">
        <div class="survey-title">Survei Kepuasan Masyarakat</div>
        <div class="survey-subtitle">Klik atau scan QR untuk mengisi</div>
        <img class="survey-qr"
             src="https://api.qrserver.com/v1/create-qr-code/?size=220x220&data={$host}survei-kepuasan/{$auth.cl_user_group_id}/{$auth.cl_kecamatan_id}/{$auth.cl_kelurahan_desa_id}"
             alt="QR Survei" />
      </a>

    </div>
  </div>

  <!-- Table: Persuratan -->
  <div class="dash-card">
    <div class="dash-card-header">
      <h3>Statistik Data Input Persuratan</h3>
      <div class="dash-card-actions">
        <button class="btn btn-success btn-sm" type="button"
                onclick="exportTableToExcel('statistik_data_input_persuratan', 'statistik_data_input_persuratan')">
          <i class="fa fa-download"></i> Export
        </button>
      </div>
    </div>

    <div class="table-responsive">
      <table id="statistik_data_input_persuratan" class="table table-bordered table-hover dash-table">
        <thead>
          <tr>
            <th>Jenis Surat</th>
            <th>Jumlah</th>
            <th>Jan</th><th>Feb</th><th>Mar</th><th>Apr</th><th>Mei</th><th>Jun</th>
            <th>Jul</th><th>Agu</th><th>Sep</th><th>Okt</th><th>Nov</th><th>Des</th>
          </tr>
        </thead>
        <tbody>
          {$t_total = 0}
          {$t_januari = 0}
          {$t_februari = 0}
          {$t_maret = 0}
          {$t_april = 0}
          {$t_mei = 0}
          {$t_juni = 0}
          {$t_juli = 0}
          {$t_agustus = 0}
          {$t_september = 0}
          {$t_oktober = 0}
          {$t_november = 0}
          {$t_desember = 0}

          {foreach from=$data.summary_persuratan item=rows}
            {$t_total = $t_total + $rows.total}
            {$t_januari = $t_januari + $rows.januari}
            {$t_februari = $t_februari + $rows.februari}
            {$t_maret = $t_maret + $rows.maret}
            {$t_april = $t_april + $rows.april}
            {$t_mei = $t_mei + $rows.mei}
            {$t_juni = $t_juni + $rows.juni}
            {$t_juli = $t_juli + $rows.juli}
            {$t_agustus = $t_agustus + $rows.agustus}
            {$t_september = $t_september + $rows.september}
            {$t_oktober = $t_oktober + $rows.oktober}
            {$t_november = $t_november + $rows.november}
            {$t_desember = $t_desember + $rows.desember}

            <tr>
              <td>{$rows.jenis_surat|upper|default:''}</td>
              <td class="text-center"><b>{$rows.total|number_format:0:",":"."|default:''}</b></td>
              <td class="text-center">{$rows.januari|number_format:0:",":"."|default:''}</td>
              <td class="text-center">{$rows.februari|number_format:0:",":"."|default:''}</td>
              <td class="text-center">{$rows.maret|number_format:0:",":"."|default:''}</td>
              <td class="text-center">{$rows.april|number_format:0:",":"."|default:''}</td>
              <td class="text-center">{$rows.mei|number_format:0:",":"."|default:''}</td>
              <td class="text-center">{$rows.juni|number_format:0:",":"."|default:''}</td>
              <td class="text-center">{$rows.juli|number_format:0:",":"."|default:''}</td>
              <td class="text-center">{$rows.agustus|number_format:0:",":"."|default:''}</td>
              <td class="text-center">{$rows.september|number_format:0:",":"."|default:''}</td>
              <td class="text-center">{$rows.oktober|number_format:0:",":"."|default:''}</td>
              <td class="text-center">{$rows.november|number_format:0:",":"."|default:''}</td>
              <td class="text-center">{$rows.desember|number_format:0:",":"."|default:''}</td>
            </tr>
          {/foreach}

          <tr class="dash-table-total">
            <td class="text-right"><b>TOTAL</b></td>
            <td class="text-center"><b>{$t_total|number_format:0:",":"."}</b></td>
            <td class="text-center"><b>{$t_januari|number_format:0:",":"."}</b></td>
            <td class="text-center"><b>{$t_februari|number_format:0:",":"."}</b></td>
            <td class="text-center"><b>{$t_maret|number_format:0:",":"."}</b></td>	
		</div>
	</div>
</section>


<script type="text/javascript" src="https://unpkg.com/xlsx@0.15.1/dist/xlsx.full.min.js"></script>
<script type="text/javascript">

// Simpan cl_user_group_id ke localStorage (pastikan escape string JS)
localStorage.setItem('cl_user_group_id', "{$cl_user_group_id|escape:'javascript'}");

// Data chart di-assign ke variable JS dengan Smarty (hilangkan koma terakhir dengan if not last)
var chartStatusKawin = [{
  name: 'STATUS KAWIN',
  colorByPoint: true,
  data: [
    {foreach from=$data.status_kawin item=rows name=sk}
    {
      name: '{$rows.keterangan|escape:"javascript"}',
      y: {$rows.total|default:0},
      color: getRandomColor()
    }{if not $smarty.foreach.sk.last},{/if}
    {/foreach}
  ]
}];

var chartStatusData = [{
  name: 'STATUS DATA',
  colorByPoint: true,
  data: [
    {foreach from=$data.status_data item=rows name=sd}
    {
      name: '{$rows.keterangan|escape:"javascript"}',
      y: {$rows.total|default:0},
      color: getRandomColor()
    }{if not $smarty.foreach.sd.last},{/if}
    {/foreach}
  ]
}];

// softColor()


var chartXXAgama = [
	{foreach from=$data.agama item=rows}
		'{$rows.keterangan}',
	{/foreach}
];

var chartAgama = [{
	name: 'Berdasarkan AGAMA',
	colorByPoint: true,
	data: [
		{foreach from=$data.agama item=rows}
			{
				name: '{$rows.keterangan}',
				y: {$rows.total},
				color: getRandomColor()
			},
		{/foreach}
	]
}];

var chartXXPendidikan = [
  {foreach from=$data.pendidikan item=rows name=pd}
  '{$rows.keterangan|escape:"javascript"}'{if not $smarty.foreach.pd.last},{/if}
  {/foreach}
];

var chartPendidikan = [{
  name: 'GRAFIK PENDIDIKAN',
  data: [
    {foreach from=$data.pendidikan item=rows name=pd2}
    {
      y: {$rows.total|default:0},
      color: getRandomColor()
    }{if not $smarty.foreach.pd2.last},{/if}
    {/foreach}
  ]
}];

var chartXXUmur = [
  {foreach from=$data.range_umur item=rows name=um}
  '{$rows.keterangan|escape:"javascript"}'{if not $smarty.foreach.um.last},{/if}
  {/foreach}
];

var chartUmur = [{
  name: 'GRAFIK RANGE UMUR',
  data: [
    {foreach from=$data.range_umur item=rows name=um2}
    {
      y: {$rows.total|default:0},
      color: getRandomColor()
    }{if not $smarty.foreach.um2.last},{/if}
    {/foreach}
  ]
}];

var chartXXSkm = {$data.skm|json_encode nofilter}.map(u => u.nama);
var chartSkm = [{
	name: 'NRR per Unsur',
	colorByPoint: true,
	data: {$data.skm|json_encode nofilter}.map(u => ({
		name: u.nama,
		y: parseFloat(u.nilai),
		color:getRandomColor() // kalau pakai warna
	}))
}];


// function getRandomColor() {
//   var hue = Math.floor(Math.random() * 360);
//   var saturation = Math.floor(Math.random() * 30) + 60;
//   var lightness = Math.floor(Math.random() * 20) + 30;

//   return 'hsl(' + hue + ', ' + saturation + '%, ' + lightness + '%)';
// }
function getRandomColor() {
  var hue = Math.floor(Math.random() * 360);

  return {
    linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1 },
    stops: [
      [0,  'hsl(' + hue + ', 80%, 40%)'], // atas
      [0.7,'hsl(' + hue + ', 80%, 30%)'],
      [1,  'hsl(' + hue + ', 80%, 22%)']  // bawah (gelap)
    ]
  };
}

// Variabel global untuk instance Highcharts supaya chart tidak terinisialisasi ulang
var hcChartStatusKawin = null;
var hcChartStatusData = null;
var hcChartAgama = null;
var hcChartPendidikan = null;
var hcChartRangeUmur = null;
var hcChartSkm = null;

// Fungsi Inisialisasi chart masing-masing container (hanya inisialisasi jika belum ada)
function initChartStatusKawin() {
  if (!hcChartStatusKawin) {
    hcChartStatusKawin = genPieChart("chart_status_kawin_new", "status_kawin", "", chartStatusKawin);
  }
}

function initChartStatusData() {
  if (!hcChartStatusData) {
    hcChartStatusData = genPieChart("chart_status_data_new", "status_data", "", chartStatusData);
  }
}

function initChartAgama() {
  if (!hcChartAgama) {
    hcChartAgama = genColumnChart("chart_agama_new", "agama", chartXXAgama, chartAgama);
  }
}

function initChartPendidikan() {
  if (!hcChartPendidikan) {
    hcChartPendidikan = genColumnChart("chart_pendidikan_new", "pendidikan", chartXXPendidikan, chartPendidikan);
  }
}

function initChartRangeUmur() {
  if (!hcChartRangeUmur) {
    hcChartRangeUmur = genColumnChart("chart_range_umur_new", "range_umur", chartXXUmur, chartUmur);
  }
}

function initChartSkm() {
  if (!hcChartSkm) {
    hcChartSkm = genColumnChart("chart_skm", "skm", chartXXSkm, chartSkm);
  }
}

// Fungsi mereflow semua chart Highcharts yang sudah diinisialisasi
function reflowAllHighcharts() {
  if (window.Highcharts && Array.isArray(Highcharts.charts)) {
    Highcharts.charts.forEach(function (chart) {
      if (chart) chart.reflow();
    });
  }
}

// Inisialisasi chart saat document siap dan target tab aktif
$(document).ready(function () {
  // Inisialisasi chart di tab aktif default, misal 'Agama' bisa sesuaikan sesuai tab Anda aktif default-nya
  initChartPendidikan();

    jQuery('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
      var targetTab = jQuery(e.target).attr('href'); // #tabId

      switch (targetTab) {
        case '#tabStatusKawin':
          initChartStatusKawin();
          break;
        case '#tabStatusData':
          initChartStatusData();
          break;
        case '#tabAgama':
          initChartAgama();
          break;
        case '#tabPendidikan':
          initChartPendidikan();
          break;
        case '#tabRangeUmur':
          initChartRangeUmur();
          break;
        case '#tabSkm':
          initChartSkm();
          break;
      }

      reflowAllHighcharts();
    });
});


// Fungsi export table (sama dengan yang sudah Anda pakai)
function exportTableToExcel(tableID, filename) {
  var dataType = 'application/vnd.ms-excel';
  var tableSelect = document.getElementById(tableID);

  if (!tableSelect) {
    console.error('Table tidak ditemukan:', tableID);
    return;
  }

  var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');
  filename = filename ? filename + '.xls' : 'excel_data.xls';

  var downloadLink = document.createElement('a');
  document.body.appendChild(downloadLink);

  if (navigator.msSaveOrOpenBlob) {
    var blob = new Blob(['\ufeff', tableHTML], { type: dataType });
    navigator.msSaveOrOpenBlob(blob, filename);
  } else {
    downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
    downloadLink.download = filename;
    downloadLink.click();
  }

  document.body.removeChild(downloadLink);
}


</script>