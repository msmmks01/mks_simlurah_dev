<style>
  .disabled_aja{
    pointer-events:none;
    opacity:0.6;
    cursor:not-allowed;
  }
  table th, table td{
    padding:8px;
  }
  .row-hover:hover{
    background:#7fffd46e;
  }
</style>

<form
  id="form_{$acak}"
  method="post"
  url="{$host}backoffice-simpan/verifikasi_lpj_rt_rw"
>

  <input type="hidden" name="button_verifikasi_lpj" value="{$sts|default:'add'}">

  <div class="row">
    <div class="col-md-12">
      <div class="box box-primary">

        <div class="box-header with-border">
          <h3 class="box-title">Form Verifikasi LPJ RT RW</h3>
        </div>

        <div class="box-body">

          <!-- ================= HEADER FORM ================= -->
          <div class="row" style="margin-bottom:15px">

            <!-- Kelurahan -->
            <div class="col-md-4">
              <label>Kelurahan</label>
              <input type="text"
                     class="form-control"
                     value="{$kel.nama|default:''}"
                     readonly>
              <input type="hidden"
                     name="cl_kelurahan_desa_id"
                     value="{$kel.id|default:''}">
            </div>

            <!-- NIK -->
            <div class="col-md-4">
              <label>NIK</label>
              <input type="text"
                    class="form-control"
                    name="nik"
                    id="nik"
                    value="{$nik|default:''}"
                    readonly>
              <input type="hidden"
                     name="tbl_data_rt_rw_id"
                     value="{$tbl_data_rt_rw_id|default:''}">
            </div>

            <!-- Bulan -->
            <div class="col-md-2">
              <label>Bulan</label>
              <input type="text"
                     class="form-control"
                     value="{$bulan_text|default:''}"
                     readonly>
              <input type="hidden"
                     name="bulan"
                     value="{$bulan|default:''}">
            </div>

            <!-- Tanggal Verifikasi -->
            <div class="col-md-2">
              <label>Tanggal Verifikasi</label>
              <input type="date"
                     class="form-control"
                     name="tgl_surat"
                     required>
            </div>

          </div>

          <!-- ================= TABEL KATEGORI ================= -->
          <fieldset class="form-group">
            <legend style="border-left:5px solid #E17A35;padding-left:10px;font-weight:bold">
              INFORMASI VERIFIKASI LPJ RT RW
            </legend>
          </fieldset>

          <table style="width:100%;border-collapse:collapse">
            <tr>
              <th style="border:1px solid #000;width:40px;text-align:center">NO</th>
              <th style="border:1px solid #000;width:350px;text-align:left">INDIKATOR / SUB INDIKATOR</th>
              <th style="border:1px solid #000;width:40px;text-align:center">Vol &amp; Sat</th>
              <th style="border:1px solid #000;width:200px;text-align:center">File</th>
              <th style="border:1px solid #000;width:80px;text-align:center">ACTION</th>
            </tr>

            {assign var=no value=1}
            {foreach from=$kategori_penilaian item=row}
            <tr class="row-hover">
              <td style="border:1px solid #000;text-align:center">
                {$no}
                <input type="hidden" name="kategori_penilaian_id[]" value="{$row.id}">
              </td>
              <td style="border:1px solid #000">
                {$row.uraian}
              </td>
              <td style="border:1px solid #000;text-align:center">
                {$row.satuan|default:'-'}
              </td>
              <td style="border:1px solid #000;text-align:center">
                {if $row.file_path neq ''}
                  <img src="{$host}{$row.file_path}" width="80">
                {else}
                  <small style="color:red">Belum upload</small>
                {/if}
              </td>
              <td style="border:1px solid #000;text-align:center">
                <input type="checkbox"
                      class="cek-verifikasi"
                      name="verifikasi[]"
                      value="{$row.id}"
                      {if empty($row.file_path)}disabled="disabled"{/if}>
              </td>
            </tr>
            {assign var=no value=$no+1}
            {/foreach}
          </table>

          <!-- ================= CEK ALL ================= -->
          <div class="row" style="margin-top:10px">
            <div class="col-md-12">
              <label style="font-weight:bold;cursor:pointer">
                <input type="checkbox" id="cek_all_verifikasi">
                All ceklis verifikasi
              </label>
            </div>
          </div>

          <!-- ================= TOMBOL ================= -->
          <div class="row" style="margin-top:20px">
            <div class="col-md-12">
              {include file="backend/template/button_save.html"
                text="Simpan"
                id_na="save"
                style_btn="btn-success"}

              {include file="backend/template/button_save.html"
                text="Kembali"
                id_na="cancel"
                style_btn="btn-danger"
                click="$('#grid_nya_{$mod}').show();$('#detil_nya_{$mod}').hide();"}
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</form>

<script>
  // cek all
  $('#cek_all_verifikasi').on('change', function(){
    $('.cek-verifikasi').prop('checked', this.checked);
  });

  // validasi minimal
  $("#form_{$acak}").validate({
    rules:{
      cl_kelurahan_desa_id:"required",
      tbl_data_rt_rw_id:"required",
      bulan:"required",
      tgl_surat:"required"
    },
    messages:{
      tgl_surat:"<i style='color:red'>Harus diisi</i>"
    },
    submitHandler:function(form){
      $.LoadingOverlay("show");
      submit_form("form_{$acak}", function(r){
        if(r==1){
          $.messager.alert(nama_apps,"Data berhasil disimpan","info");
          $("#cancel_{$acak}").trigger("click");
        }else{
          $.messager.alert(nama_apps,"Gagal menyimpan : "+r,"warning");
        }
        $.LoadingOverlay("hide",true);
      });
    }
  });
</script>
